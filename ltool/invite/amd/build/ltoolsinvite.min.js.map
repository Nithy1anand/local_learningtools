{"version":3,"sources":["../src/ltoolsinvite.js"],"names":["define","$","ModalFactory","Str","Fragment","ModalEvents","Ajax","notification","learningToolInviteAction","params","showModalInvitetool","inviteinfo","document","querySelector","addEventListener","create","title","getListInviteUsers","type","types","SAVE_CANCEL","body","getInviteAction","large","then","modal","setSaveButtonText","get_string","show","getRoot","on","hidden","destroy","save","e","preventDefault","submitFormData","submit","catch","exception","modalform","querySelectorAll","formData","URLSearchParams","FormData","toString","JSON","stringify","call","methodname","args","formdata","done","response","hide","successinfo","when","localizedEditString","addNotification","message","loadFragment","contextid","listaction","strinviteusers","listurl","M","cfg","wwwroot","user","course","strinvitelist","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Invite ltool define js.\n * @package   ltool_invite\n * @category  Classes - autoloading\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/modal_factory', 'core/str', 'core/fragment', 'core/modal_events', 'core/ajax', 'core/notification'],\n function($, ModalFactory, Str, Fragment, ModalEvents, Ajax, notification) {\n\n    /**\n     * Controls bookmarks tool action.\n     * @param {object} params\n     */\n    function learningToolInviteAction(params) {\n        showModalInvitetool(params);\n    }\n\n    /**\n     * Display the modal to invite user emails.\n     * @param {object} params\n     */\n    function showModalInvitetool(params) {\n        var inviteinfo = document.querySelector(\".ltoolinvite-info #ltoolinvite-action\");\n        if (inviteinfo) {\n            inviteinfo.addEventListener(\"click\", function() {\n                // Strinviteusers.\n                ModalFactory.create({\n                    title: getListInviteUsers(params),\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: getInviteAction(params),\n                    large: true\n                }).then(function(modal) {\n                    modal.setSaveButtonText(Str.get_string('invitenow', 'local_learningtools'));\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        submitFormData(modal, params);\n                        modal.getRoot().submit();\n                    });\n                    return modal;\n                }).catch(notification.exception);\n            });\n        }\n    }\n\n    /**\n     * Submit the modal data form.\n     * @param {object} modal object\n     * @param {array} params  list of parameters\n     * @return {void} ajax respoltoolsnse.\n     */\n    function submitFormData(modal, params) {\n        var modalform = document.querySelectorAll('#invite-users-area form')[0];\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\n        params = JSON.stringify(params);\n        Ajax.call([{\n            methodname: 'ltool_invite_inviteusers',\n            args: {params: params, formdata: formData},\n            done: function(response) {\n                modal.hide();\n                if (response) {\n                    var successinfo = Str.get_string('successinviteusers', 'local_learningtools');\n                    $.when(successinfo).done(function(localizedEditString) {\n                        notification.addNotification({\n                            message: localizedEditString,\n                            type: \"success\"\n                        });\n                    });\n                }\n            }\n        }]);\n    }\n    /**\n     * Get invite user emails form.\n     * @param {object} params\n     * @return {string} textarea html\n     */\n    function getInviteAction(params) {\n        return Fragment.loadFragment('ltool_invite', 'get_inviteusers_form', params.contextid, params);\n    }\n    /**\n     * Display the list of invite users link.\n     * @param {object} params\n     * @returns {string} list of invite users link.\n     */\n    function getListInviteUsers(params) {\n        var listaction = \"<p>\" + params.strinviteusers + \"</p>\";\n        var listurl = M.cfg.wwwroot + \"/local/learningtools/ltool/invite/list.php?id=\" + params.user +\n        \"&courseid=\" + params.course;\n        listaction += \"<div id='list-action-url'><a href='\" + listurl + \"' target='_blank'>\" + params.strinvitelist + \"</a></div>\";\n        return listaction;\n    }\n\n    return {\n        init: function(params) {\n            learningToolInviteAction(params);\n        }\n    };\n });"],"file":"ltoolsinvite.min.js"}